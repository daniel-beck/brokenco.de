--- 
layout: post
title: "Proposal: Imuse, an IMAP-capable FUSE filesystem"
tags: 
- miscellaneous
- software development
created: 1231771033
---
I've spent the better part of my weekend messing around with mail clients, and once again <a href="http://www.gnome.org/projects/evolution/" target="_blank">Evolution</a> comes out on top and once again, I'm not happy about it. I tried: <a href="http://www.claws-mail.org/" target="_blank">Claws</a>, <a href="http://www.mozilla.com/thunderbird/" target="_blank">Thunderbird</a>, <a href="http://www.washington.edu/alpine/" target="_blank">Alpine</a> (formerly Pine), <a href="http://www.mutt.org/" target="_blank">Mutt</a>, <a href="http://balsa.gnome.org/" target="_blank">Balsa</a>, <a href="http://kontact.kde.org/kmail/"  target="_blank">KMail</a> and <a href="http://www.tkrat.org/" target="_blank">TkRat</a>. <strong>None</strong> of them worked as well as I wanted, is it too much to ask for to have a mail client that doesn't puke and die on large (>2GB) of IMAP mail? Supports proper <a href="http://www.jwz.org/doc/threading.html" target="_blank">jwz mail threading</a>? And caches IMAP mail locally so I can actually access it while disconnect? Turns out it actually is too much to ask.<br>
<style type="text/css">#primary .singlepage .node .content li { font-size: 1em; }</style><br>
That's not what this is about though. While hunting around, I started to look at my <a href="http://slide.com" target="_blank">Slide</a> IMAP mail account, and see something interesting: it looks suspiciously like a filesystem. The general layout I have right now is something like this:<ul><li>/<ul><li>INBOX</li><li>Sent</li><li>Drafts</li><li>Development/<ul><li>Commits</li><li>Pushes</li></ul></li><li>External/<ul><li>Git</li><li>Hudson</li></ul></li><li>Metrics</li><li>QA/<ul><li>Exceptions</li><li>Trac</li></ul></li></ul></li></ul><br>
<br>
Clearly, it's a very filesystem-esque looking tree of mail (and a couple gigabytes of it). When you start to really dig into e-mail technology, you really get a feeling for how royally screwed up the whole ecosystem is. Between Exchange, IMAP and POP3 (and their SSL counterparts), mbox and Maildir, and of course the venerable SMTP; e-mail technology is a clusterfuck. No wonder barely anybody can implement an e-mail client that doesn't suck.<br>
<br>
At a basic level, mail is organized into messages and folders. Messages map very easily to actual files on the filesystem, and folders naturually map into actual directories on the filesystem. Imagine that you could chose any program you wanted to read and write your email? The only pre-requisite: can it read from the filesystem? You could have any program register to receive filesystem events to notify you when mail "appears" in specific directories, and you could move mail around with a simple drag-and-drop in Nautilus/Thunar/Finder. What about writing mail though? Easy enough, you create a new file in the "Drafts" folder, writes would naturally be propogated to the "Drafts" folder on the IMAP server, and when you were done with the message, you could copy or move it into the "Sent" folder, which would have a hook to recognize the new file, and send it. The IMAP tree from above, starts to look something like this: <ul><li>~/Imuse<ul><li>Settings</li><li>Accounts/<ul><li>Slide/<ul><li>INBOX</li><li>Sent</li><li>Drafts</li><li>Development/<ul><li>Commits</li><li>Pushes</li></ul></li><li>External/<ul><li>Git</li><li>Hudson</li></ul></li><li>Metrics</li><li>QA/<ul><li>Exceptions</li><li>Trac</li></ul></li></ul></li></ul></li></ul></ul><br>
<br>
"Accounts" and "Settings" would likely need to be "special" insofar that Imuse would just create them out of thin air, Accounts would need to be a virtual directory to actually contain the appropriate account listings, and in Settings I'd likely want to have a couple of flat configuration "files" that you could edit in order to actually configure Imuse appropriately.<br>
<br>
If there are simply lists of files in each of the Accounts' folders, each representing a particular email, then the problem of dealing with all my e-mail becomes a much easier one to handle, then it's just a matter of picking my filesystem browser of choice. Even then it's not really limited to filesystem browsers like Nautilus, the scope of programs that I can use to access my mail is opened up to $EDITOR as well. Most editors like Notepad++, Vim, Emacs, Gedit, and TextMate all support the ability to view a directory, and open it's contents up for reading/editing. I'm a big fan using Vim, so Imuse coupled with <a href="http://www.vim.org/scripts/script.php?script_id=184" target="_blank">vtreeexplorer</a> would be phenomonal to say the least.<br>
<br>
I've started toying around with building FUSE filesystems and I've pushed my experimenting up to GitHub in <a href="https://github.com/rtyler/imuse/tree" target="_blank">my imuse repository</a>. It's currently in C, since I either cannot get either of the two FUSE Python bindings to work properly. This presents a certain level of difficulty, since the standard means of accessing IMAP data from C seems to be <a href="http://www.washington.edu/imap/documentation/internal.txt.html" target="_blank">c-client</a>, which is reasonably well documented, but lacks sample code. On the other hand, if I can get the Python bindings to cooperate, then I have access to the wonderful <a href="http://twistedmatrix.com/trac/wiki/TwistedMail" target="_blank">Twisted Mail</a> library (or even <a href="http://docs.python.org/library/imaplib.html" target="_blank">the basic imaplib</a>).<br>
<br>
Given my obvious time restrictions, I wanted to open the idea up to more eyes and ears to see what others thought and maybe even find somebody else willing to pitch in. For the time being however, Evolution is still sifting through my mail, and I'm still not enjoying it :(<br>
<!--break--><br>
